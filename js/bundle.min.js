(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){let numberCountriesCFM=0;let regionsArr=["All regions"],organisationsArr=["All organizations"];let countriesISO3Arr=[];function choroplethMap(){mapsvg.selectAll("path").each(function(element,index){d3.select(this).transition().duration(500).attr("fill",function(d){return"#ccc"})})}function generateDefaultDetailPane(){var orgNums=organisationsArr.length-1;$(".details > h6").text("global overwiew");$("#globalStats").html("");$("#globalStats").append('<div class="row">'+'<div class="col-sm-4 key-figure">'+'<div class="num" id="totalCfms">'+cfmData.length+"</div>"+"<h5># feedback mechanisms</h5>"+"</div>"+'<div class="col-sm-4 key-figure">'+'<div class="num" id="countriesCFM">'+countriesISO3Arr.length+"</div>"+"<h5># countries</h5>"+"</div>"+'<div class="col-sm-4 key-figure">'+'<div class="num" id="orgsCFM">'+orgNums+"</div>"+"<h5># organizations</h5>"+"</div>"+"</div>");$("#overview").addClass("hidden");$("#globalStats").removeClass("hidden")}function updatePane(data,title){var arrCountries=[],arrOrgs=[];data.forEach(element=>{arrCountries.includes(element["Country"])?"":arrCountries.push(element["Country"]);arrOrgs.includes(element["Organisation Name"])?"":arrOrgs.push(element["Organisation Name"])});$(".details > h6").text(title);$("#totalCfms").text(data.length);$("#countriesCFM").text(arrCountries.length);$("#orgsCFM").text(arrOrgs.length)}function getColumnUniqueValues(){var values=[];for(let index=0;index<arguments.length;index++){var arr=[];values.push(arr)}for(let index=0;index<arguments.length;index++){var col=arguments[index];var arr=[];filteredCfmData.forEach(element=>{arr.includes(element[col])?"":arr.push(element[col])});values[index]=arr}return values}function generateRegionDropdown(){var options="";for(let index=0;index<regionsArr.length;index++){const element=regionsArr[index];index==0?options+='<option value="all" selected>'+element+"</option>":options+='<option value="'+element+'">'+element+"</option>"}$("#regionSelect").append(options);$("#all").toggleClass("active")}function generateOrgDropdown(){var options="";for(let index=0;index<organisationsArr.length;index++){const element=organisationsArr[index];index==0?options+='<option value="all" selected>'+element+"</option>":options+='<option value="'+element+'">'+element+"</option>"}$("#orgSelect").append(options);$("#all").toggleClass("active")}let countriesArr=[];let g,mapsvg,projection,width,height,zoom,path;let viewportWidth=window.innerWidth;let currentZoom=1;let mapClicked=false;let selectedCountryFromMap="all";let countrySelectedFromMap=false;let mapFillColor="#204669",mapInactive="#fff",mapActive="#2F9C67",hoverColor="#2F9C67";function initiateMap(){width=viewportWidth;height=500;var mapScale=width/10.6;var mapCenter=[25,25];projection=d3.geoMercator().center(mapCenter).scale(mapScale).translate([width/2.9,height/1.6]);path=d3.geoPath().projection(projection);zoom=d3.zoom().scaleExtent([1,8]).on("zoom",zoomed);mapsvg=d3.select("#map").append("svg").attr("width",width).attr("height",height).call(zoom).on("wheel.zoom",null).on("dblclick.zoom",null);mapsvg.append("rect").attr("width","100%").attr("height","100%").attr("fill","#ccd4d8");var maptip=d3.select("#map").append("div").attr("class","d3-tip map-tip hidden");g=mapsvg.append("g").attr("id","countries").selectAll("path").data(geomData.features).enter().append("path").attr("d",path).attr("id",function(d){return d.properties.countryIso3Code}).attr("class",function(d){var className=countriesISO3Arr.includes(d.properties.ISO_A3)?"hasStudy":"inactive";return className}).attr("fill",function(d){return countriesISO3Arr.includes(d.properties.ISO_A3)?mapFillColor:mapInactive}).attr("stroke-width",.2).attr("stroke","#ccc");mapsvg.transition().duration(750).call(zoom.transform,d3.zoomIdentity);d3.select("#zoom_in").on("click",function(){zoom.scaleBy(mapsvg.transition().duration(500),1.5)});d3.select("#zoom_out").on("click",function(){zoom.scaleBy(mapsvg.transition().duration(500),.5)});var tipPays=d3.select("#countries").selectAll("path");g.filter(".hasStudy").on("mousemove",function(d){if(!$(this).hasClass("clicked")){$(this).attr("fill",hoverColor)}if(!mapClicked){}var mouse=d3.mouse(mapsvg.node()).map(function(d){return parseInt(d)});maptip.classed("hidden",false).attr("style","left:"+mouse[0]+"px; top:"+(mouse[1]+25)+"px").html(d.properties.NAME)}).on("mouseout",function(d){if(!$(this).hasClass("clicked")){$(this).attr("fill",mapFillColor)}if(!mapClicked){}maptip.classed("hidden",true)}).on("click",function(d){mapClicked=true;selectedCountryFromMap=d.properties.NAME;mapsvg.select("g").selectAll(".hasStudy").attr("fill",mapFillColor);$(this).attr("fill",hoverColor);$(this).addClass("clicked");var countryData=filteredCfmData.filter(function(val){return d.properties.ISO_A3==val["ISO3"]});updateDataTable(countryData)})}function showMapTooltip(d,maptip,text){var mouse=d3.mouse(mapsvg.node()).map(function(d){return parseInt(d)});maptip.classed("hidden",false).attr("style","left:"+(mouse[0]+20)+"px;top:"+(mouse[1]+20)+"px").html(text)}function hideMapTooltip(maptip){maptip.classed("hidden",true)}function zoomed(){const{transform:transform}=d3.event;currentZoom=transform.k;if(!isNaN(transform.k)){g.attr("transform",transform);g.attr("stroke-width",1/transform.k)}}function zoomToRegion(region){var isInRegion=true;if(region=="All regions"){mapsvg.transition().duration(750).call(zoom.transform,d3.zoomIdentity)}else{var oneCountry=getFirstCountryOfRegion(region);geomData.features.forEach(function(c){if(c.properties.ISO_A3==oneCountry){var offsetX=0;var offsetY=0;const[[x0,y0],[x1,y1]]=path.bounds(c);mapsvg.transition().duration(750).call(zoom.transform,d3.zoomIdentity.translate(width/2,height/2).scale(Math.min(3,.9/Math.max((x1-x0)/width,(y1-y0)/height))).translate(-(x0+x1)/2+offsetX,-(y0+y1)/2-offsetY))}})}}function getFirstCountryOfRegion(region){var country="";region=="ESAR"?country="BDI":region=="WCAR"?country="TCD":region=="AP"?country="MYS":region=="LAC"?country="COL":region=="MENA"?country="YEM":region=="EURO"?country="TUR":"";return country}function getDataTableData(data=filteredCfmData){var dt=[];data.forEach(element=>{dt.push([element["id"],element["Country"],element["Organisation Name"],element["Frequency"],element["Channels"],element["Emergency"],'<a href="'+element["Link"]+'" target="blank"><i class="fa fa-external-link"></i></a>',element["Name"],element["Scale"],element["# Feedbacks (last 6 months)"],element["Target"],element["Details"],element["Keyword"],element["National Coordination"],element["Inter-agency"],element["Partners"],element["Contact email"],element["Status"]])});return dt}function generateDataTable(){var dtData=getDataTableData();datatable=$("#datatable").DataTable({data:dtData,columns:[{className:"details-control",orderable:false,data:null,defaultContent:'<i class="fa fa-plus-circle"></i>',width:"1%"},{width:"15%"},{width:"10%"},{width:"5%"},{width:"25%"},{width:"15%"},{width:"1%"}],columnDefs:[{className:"dt-head-left",targets:"_all"},{defaultContent:"-",targets:"_all"},{targets:[7],visible:false},{targets:[8],visible:false},{targets:[9],visible:false},{targets:[10],visible:false},{targets:[11],visible:false},{targets:[12],visible:false},{targets:[13],visible:false},{targets:[14],visible:false},{targets:[15],visible:false},{targets:[16],visible:false},{targets:[16],visible:false}],pageLength:10,bLengthChange:false,pagingType:"simple_numbers",dom:"Blrtp",buttons:{buttons:[{extend:"excelHtml5",className:"exportData",exportOptions:{page:":all",format:{header:function(data,columnIdx){var hd=["Name","Scale","# Feedbacks (last 6 months)","Target","Details","Keyword","National Coordination","Inter-agency","Partners","Contact email","Status"];if(columnIdx>=7){return hd[columnIdx-7]}else{return data}}}}}]}});$("#datatable tbody").on("click","td.details-control",function(){var tr=$(this).closest("tr");var row=datatable.row(tr);if(row.child.isShown()){row.child.hide();tr.removeClass("shown");tr.css("background-color","#fff");tr.find("td.details-control i").removeClass("fa-minus-circle");tr.find("td.details-control i").addClass("fa-plus-circle")}else{row.child(format(row.data())).show();tr.addClass("shown");tr.css("background-color","#f5f5f5");$("#cfmDetails").parent("td").css("border-top",0);$("#cfmDetails").parent("td").css("padding",0);$("#cfmDetails").parent("td").css("background-color","#f5f5f5");tr.find("td.details-control i").removeClass("fa-plus-circle");tr.find("td.details-control i").addClass("fa-minus-circle")}})}$("#exportTable").on("click",function(){$(".buttons-excel").trigger("click")});function format(arr){filtered=cfmData.filter(function(d){return d["id"]==arr[0]});return'<table class="tabDetail" id="cfmDetails" >'+"<tr>"+"<td>&nbsp;</td>"+"<td>&nbsp;</td>"+"<td>&nbsp;</td>"+"<td>"+"<table>"+"<tbody>"+"<tr>"+"<td><strong>Name</strong></td>"+"<td>"+filtered[0]["Name"]+"</td>"+"<td><strong>Start date</strong></td>"+"<td>"+filtered[0]["Start date"]+"</td>"+"<td><strong># Feedback</strong></td>"+"<td>"+filtered[0]["# Feedbacks (last 6 months)"]+"</td>"+"</tr>"+"<tr>"+"<td><strong>Scale</strong></td>"+"<td>"+filtered[0]["Scale"]+"</td>"+"<td><strong>National Coordination<strong></td>"+"<td>"+filtered[0]["National Coordination"]+"</td>"+"<td><strong>Partners<strong></td>"+"<td>"+filtered[0]["Partners"]+"</td>"+"</tr>"+"<tr>"+"<td><strong>Status<s/trong></td>"+"<td>"+filtered[0]["Status"]+"</td>"+"<td><strong>Interagency</strong></td>"+"<td>"+filtered[0]["Inter-agency"]+"</td>"+"<td><strong>Keywords</strong></td>"+"<td>"+filtered[0]["Keyword"]+"</td>"+"</tr>"+"<tr>"+"<td><strong>Target</strong></td>"+"<td>"+filtered[0]["Target"]+"</td>"+"<td><strong>Contact<strong></td>"+"<td>"+filtered[0]["Contact Email"]+"</td>"+"<td><strong>Details<strong></td>"+"<td>"+filtered[0]["Details"]+"</td>"+"</tr>"+"</tbody>"+"</table>"+"</td>"+"<td>&nbsp;</td>"+"</tr>"+"</table>"}function updateDataTable(data=cfmData){var dt=getDataTableData(data);$("#datatable").dataTable().fnClearTable();$("#datatable").dataTable().fnAddData(dt)}function getFilteredDataFromDropdown(){var org=$("#orgSelect").val();var region=$("#regionSelect").val();var data;if(org!="all"&&region!="all"){data=filteredCfmData.filter(function(d){return d["Region"]==region&&d["Organisation Name"]==org})}else{org=="all"?data=filteredCfmData.filter(function(d){return d["Region"]==region}):region=="all"?data=filteredCfmData.filter(function(d){return d["Organisation Name"]==org}):""}return data}function getFormattedColumn(item){var items=[];var arr=item.split(",");var trimedArr=arr.map(x=>x.trim());for(let index=0;index<trimedArr.length;index++){if(trimedArr[index]){items.push(trimedArr[index])}}return items}var buttons=document.getElementsByClassName("filter");for(var i=0;i<buttons.length;i++){buttons[i].addEventListener("click",clickButton)}function clickButton(){$(".btn").removeClass("active");var filter;var colSelected=this.value;if(["Active","Under Development","Inactive","Closed"].includes(colSelected)){filter=cfmData.filter(function(d){return d["Status"]==colSelected})}else{if(["COVID-19","Ebola"].includes(colSelected)){filter=cfmData.filter(function(d){var arr=getFormattedColumn(d["Emergency"]);return arr.includes(colSelected)})}else{filter=cfmData.filter(function(d){var arr=getFormattedColumn(d["Emergency"]);return!arr.includes("COVID-19")&&!arr.includes("Ebola")})}}updateDataTable(filter);$("#orgSelect").val("all");$("#regionSelect").val("all");updateDataTable(filter);updatePane(filter,colSelected)}$("#orgSelect").on("change",function(d){var select=$("#orgSelect").val();var filter=cfmData;select!="all"?filter=cfmData.filter(function(d){return d["Organisation Name"]==select}):null;$("#regionSelect").val("all");updateDataTable(filter);updatePane(filter,select)});$("#regionSelect").on("change",function(e){var select=$("#regionSelect").val();var filter=filteredCfmData;select!="all"?filter=filteredCfmData.filter(function(d){return d["Region"]==select}):null;$("#orgSelect").val("all");updateDataTable(filter);updatePane(filter,select)});$("#reset-table").on("click",function(){$("#regionSelect").val("all");$("#orgSelect").val("all");generateDefaultDetailPane();mapsvg.select("g").selectAll(".hasStudy").attr("fill",mapFillColor);var dt=getDataTableData();$("#datatable").dataTable().fnClearTable();$("#datatable").dataTable().fnAddData(dt)});let geodataUrl="data/wld.json";let cfmDataUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vSbPRrmlDfV3WzI-5QizI2ig2AoJo84KS7pSQtXkUiV5BD3s4uxpXqW8rK2sHmNjP2yCavO1XasLyCe/pub?gid=126026288&single=true&output=csv";let geomData,cfmData,filteredCfmData;$(document).ready(function(){function getData(){Promise.all([d3.json(geodataUrl),d3.csv(cfmDataUrl)]).then(function(data){geomData=topojson.feature(data[0],data[0].objects.worldtopo12022020);var id=0;data[1].forEach(element=>{element["id"]=id+1;id=id+1+Math.floor(Math.random()*10)});cfmData=data[1];filteredCfmData=data[1];var colUniqueValues=getColumnUniqueValues("Country","ISO3","Region","Organisation Name");countriesArr=colUniqueValues[0],countriesISO3Arr=colUniqueValues[1],regionsArr.push(...colUniqueValues[2]),organisationsArr.push(...colUniqueValues[3]);generateDefaultDetailPane();generateRegionDropdown();generateOrgDropdown();initiateMap();generateDataTable();$(".loader").hide();$("#main").css("opacity",1)})}getData()})},{}]},{},[1]);
